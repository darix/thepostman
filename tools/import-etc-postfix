#!/usr/bin/python3
#
# thepostman
#
# Copyright (C) 2025   darix
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Affero General Public License for more details.
#
# You should have received a copy of the GNU Affero General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
#
import yaml
import os
import re

# keep in sync with salt/thepostman/init.sls
config_defaults = {
    'master.cf': {
      "smtp-inet":{"name":"smtp","type":"inet","private":"n","unpriv":"-","chroot":"n","wakeup":"-","maxproc":"-","command":"smtpd"},
      "dnsblog-unix":{"name":"dnsblog","type":"unix","private":"-","unpriv":"-","chroot":"n","wakeup":"-","maxproc":"0","command":"dnsblog"},
      "tlsproxy-unix":{"name":"tlsproxy","type":"unix","private":"-","unpriv":"-","chroot":"n","wakeup":"-","maxproc":"0","command":"tlsproxy"},
      "pickup-unix":{"name":"pickup","type":"unix","private":"n","unpriv":"-","chroot":"n","wakeup":"60","maxproc":"1","command":"pickup"},
      "cleanup-unix":{"name":"cleanup","type":"unix","private":"n","unpriv":"-","chroot":"n","wakeup":"-","maxproc":"0","command":"cleanup"},
      "qmgr-unix":{"name":"qmgr","type":"unix","private":"n","unpriv":"-","chroot":"n","wakeup":"300","maxproc":"1","command":"qmgr"},
      "tlsmgr-unix":{"name":"tlsmgr","type":"unix","private":"-","unpriv":"-","chroot":"n","wakeup":"1000?","maxproc":"1","command":"tlsmgr"},
      "rewrite-unix":{"name":"rewrite","type":"unix","private":"-","unpriv":"-","chroot":"n","wakeup":"-","maxproc":"-","command":"trivial-rewrite"},
      "bounce-unix":{"name":"bounce","type":"unix","private":"-","unpriv":"-","chroot":"n","wakeup":"-","maxproc":"0","command":"bounce"},
      "defer-unix":{"name":"defer","type":"unix","private":"-","unpriv":"-","chroot":"n","wakeup":"-","maxproc":"0","command":"bounce"},
      "trace-unix":{"name":"trace","type":"unix","private":"-","unpriv":"-","chroot":"n","wakeup":"-","maxproc":"0","command":"bounce"},
      "verify-unix":{"name":"verify","type":"unix","private":"-","unpriv":"-","chroot":"n","wakeup":"-","maxproc":"1","command":"verify"},
      "flush-unix":{"name":"flush","type":"unix","private":"n","unpriv":"-","chroot":"n","wakeup":"1000?","maxproc":"0","command":"flush"},
      "proxymap-unix":{"name":"proxymap","type":"unix","private":"-","unpriv":"-","chroot":"n","wakeup":"-","maxproc":"-","command":"proxymap"},
      "proxywrite-unix":{"name":"proxywrite","type":"unix","private":"-","unpriv":"-","chroot":"n","wakeup":"-","maxproc":"1","command":"proxymap"},
      "smtp-unix":{"name":"smtp","type":"unix","private":"-","unpriv":"-","chroot":"n","wakeup":"-","maxproc":"-","command":"smtp"},
      "relay-unix":{"name":"relay","type":"unix","private":"-","unpriv":"-","chroot":"n","wakeup":"-","maxproc":"-","command":"smtp","args":"-o syslog_name=${multi_instance_name?{$multi_instance_name}:{postfix}}/$service_name"},
      "showq-unix":{"name":"showq","type":"unix","private":"n","unpriv":"-","chroot":"n","wakeup":"-","maxproc":"-","command":"showq"},
      "error-unix":{"name":"error","type":"unix","private":"-","unpriv":"-","chroot":"n","wakeup":"-","maxproc":"-","command":"error"},
      "retry-unix":{"name":"retry","type":"unix","private":"-","unpriv":"-","chroot":"n","wakeup":"-","maxproc":"-","command":"error"},
      "discard-unix":{"name":"discard","type":"unix","private":"-","unpriv":"-","chroot":"n","wakeup":"-","maxproc":"-","command":"discard"},
      "local-unix":{"name":"local","type":"unix","private":"-","unpriv":"n","chroot":"n","wakeup":"-","maxproc":"-","command":"local"},
      "virtual-unix":{"name":"virtual","type":"unix","private":"-","unpriv":"n","chroot":"n","wakeup":"-","maxproc":"-","command":"virtual"},
      "lmtp-unix":{"name":"lmtp","type":"unix","private":"-","unpriv":"-","chroot":"n","wakeup":"-","maxproc":"-","command":"lmtp"},
      "anvil-unix":{"name":"anvil","type":"unix","private":"-","unpriv":"-","chroot":"n","wakeup":"-","maxproc":"1","command":"anvil"},
      "scache-unix":{"name":"scache","type":"unix","private":"-","unpriv":"-","chroot":"n","wakeup":"-","maxproc":"1","command":"scache"},
      "postlog-unix-dgram":{"name":"postlog","type":"unix-dgram","private":"n","unpriv":"-","chroot":"n","wakeup":"-","maxproc":"1","command":"postlogd"},
    },
}

postfix_maincf_defaults = {
  '2bounce_notice_recipient': r'postmaster',
  'access_map_defer_code': r'450',
  'access_map_reject_code': r'554',
  'address_verify_cache_cleanup_interval': r'12h',
  'address_verify_default_transport': r'$default_transport',
  'address_verify_local_transport': r'$local_transport',
  'address_verify_map': r'lmdb:$data_directory/verify_cache',
  'address_verify_negative_cache': r'yes',
  'address_verify_negative_expire_time': r'3d',
  'address_verify_negative_refresh_time': r'3h',
  'address_verify_pending_request_limit': r'5000',
  'address_verify_poll_count': r'${stress?{1}:{3}}',
  'address_verify_poll_delay': r'3s',
  'address_verify_positive_expire_time': r'31d',
  'address_verify_positive_refresh_time': r'7d',
  'address_verify_relay_transport': r'$relay_transport',
  'address_verify_relayhost': r'$relayhost',
  'address_verify_sender': r'$double_bounce_sender',
  'address_verify_sender_dependent_default_transport_maps': r'$sender_dependent_default_transport_maps',
  'address_verify_sender_dependent_relayhost_maps': r'$sender_dependent_relayhost_maps',
  'address_verify_sender_ttl': r'0s',
  'address_verify_service_name': r'verify',
  'address_verify_transport_maps': r'$transport_maps',
  'address_verify_virtual_transport': r'$virtual_transport',
  'alias_database': r'lmdb:/etc/aliases',
  'alias_maps': r'lmdb:/etc/aliases',
  'allow_mail_to_commands': r'alias, forward',
  'allow_mail_to_files': r'alias, forward',
  'allow_min_user': r'no',
  'allow_percent_hack': r'yes',
  'allow_srv_lookup_fallback': r'no',
  'allow_untrusted_routing': r'no',
  'alternate_config_directories': r'',
  'always_add_missing_headers': r'no',
  'always_bcc': r'',
  'anvil_rate_time_unit': r'60s',
  'anvil_status_update_time': r'600s',
  'append_at_myorigin': r'yes',
  'append_dot_mydomain': r'${{$compatibility_level} <level {1} ? {yes} : {no}}',
  'application_event_drain_time': r'100s',
  'authorized_flush_users': r'static:anyone',
  'authorized_mailq_users': r'static:anyone',
  'authorized_submit_users': r'static:anyone',
  'backwards_bounce_logfile_compatibility': r'yes',
  'berkeley_db_create_buffer_size': r'16777216',
  'berkeley_db_read_buffer_size': r'131072',
  'best_mx_transport': r'',
  'biff': r'yes',
  'body_checks': r'',
  'body_checks_size_limit': r'51200',
  'bounce_notice_recipient': r'postmaster',
  'bounce_queue_lifetime': r'5d',
  'bounce_service_name': r'bounce',
  'bounce_size_limit': r'50000',
  'bounce_template_file': r'',
  'broken_sasl_auth_clients': r'no',
  'canonical_classes': r'envelope_sender, envelope_recipient, header_sender, header_recipient',
  'canonical_maps': r'',
  'cleanup_replace_stray_cr_lf': r'yes',
  'cleanup_service_name': r'cleanup',
  'command_directory': r'/usr/sbin',
  'command_execution_directory': r'',
  'command_expansion_filter': r'1234567890!@%-_=+:,./abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ',
  'command_time_limit': r'1000s',
  'compatibility_level': r'3.10',
  'config_directory': r'/etc/postfix',
  'confirm_delay_cleared': r'no',
  'connection_cache_protocol_timeout': r'5s',
  'connection_cache_service_name': r'scache',
  'connection_cache_status_update_time': r'600s',
  'connection_cache_ttl_limit': r'2s',
  'content_filter': r'',
  'cyrus_sasl_config_path': r'',
  'daemon_directory': r'/usr/lib/postfix/bin/',
  'daemon_table_open_error_is_fatal': r'no',
  'daemon_timeout': r'18000s',
  'data_directory': r'/var/lib/postfix',
  'debug_peer_level': r'2',
  'debug_peer_list': r'',
  'debugger_command': r'',
  'default_database_type': r'lmdb',
  'default_delivery_slot_cost': r'5',
  'default_delivery_slot_discount': r'50',
  'default_delivery_slot_loan': r'3',
  'default_delivery_status_filter': r'',
  'default_destination_concurrency_failed_cohort_limit': r'1',
  'default_destination_concurrency_limit': r'20',
  'default_destination_concurrency_negative_feedback': r'1',
  'default_destination_concurrency_positive_feedback': r'1',
  'default_destination_rate_delay': r'0s',
  'default_destination_recipient_limit': r'50',
  'default_extra_recipient_limit': r'1000',
  'default_filter_nexthop': r'',
  'default_minimum_delivery_slots': r'3',
  'default_privs': r'nobody',
  'default_process_limit': r'100',
  'default_rbl_reply': r'$rbl_code Service unavailable; $rbl_class [$rbl_what] blocked using $rbl_domain${rbl_reason?; $rbl_reason}',
  'default_recipient_limit': r'20000',
  'default_recipient_refill_delay': r'5s',
  'default_recipient_refill_limit': r'100',
  'default_transport': r'smtp',
  'default_transport_rate_delay': r'0s',
  'default_verp_delimiters': r'+=',
  'defer_code': r'450',
  'defer_service_name': r'defer',
  'defer_transports': r'',
  'delay_logging_resolution_limit': r'2',
  'delay_notice_recipient': r'postmaster',
  'delay_warning_time': r'0h',
  'deliver_lock_attempts': r'20',
  'deliver_lock_delay': r'1s',
  'destination_concurrency_feedback_debug': r'no',
  'detect_8bit_encoding_header': r'yes',
  'disable_dns_lookups': r'no',
  'disable_mime_input_processing': r'no',
  'disable_mime_output_conversion': r'no',
  'disable_verp_bounces': r'no',
  'disable_vrfy_command': r'no',
  'dns_ncache_ttl_fix_enable': r'no',
  'dnsblog_reply_delay': r'0s',
  'dnsblog_service_name': r'dnsblog',
  'dnssec_probe': r'ns:.',
  'dont_remove': r'0',
  'double_bounce_sender': r'double-bounce',
  'duplicate_filter_limit': r'1000',
  'empty_address_default_transport_maps_lookup_key': r'<>',
  'empty_address_local_login_sender_maps_lookup_key': r'<>',
  'empty_address_recipient': r'MAILER-DAEMON',
  'empty_address_relayhost_maps_lookup_key': r'<>',
  'enable_idna2003_compatibility': r'no',
  'enable_long_queue_ids': r'no',
  'enable_original_recipient': r'yes',
  'enable_threaded_bounces': r'no',
  'error_delivery_slot_cost': r'$default_delivery_slot_cost',
  'error_delivery_slot_discount': r'$default_delivery_slot_discount',
  'error_delivery_slot_loan': r'$default_delivery_slot_loan',
  'error_destination_concurrency_failed_cohort_limit': r'$default_destination_concurrency_failed_cohort_limit',
  'error_destination_concurrency_limit': r'$default_destination_concurrency_limit',
  'error_destination_concurrency_negative_feedback': r'$default_destination_concurrency_negative_feedback',
  'error_destination_concurrency_positive_feedback': r'$default_destination_concurrency_positive_feedback',
  'error_destination_rate_delay': r'$default_destination_rate_delay',
  'error_destination_recipient_limit': r'$default_destination_recipient_limit',
  'error_extra_recipient_limit': r'$default_extra_recipient_limit',
  'error_initial_destination_concurrency': r'$initial_destination_concurrency',
  'error_minimum_delivery_slots': r'$default_minimum_delivery_slots',
  'error_notice_recipient': r'postmaster',
  'error_recipient_limit': r'$default_recipient_limit',
  'error_recipient_refill_delay': r'$default_recipient_refill_delay',
  'error_recipient_refill_limit': r'$default_recipient_refill_limit',
  'error_service_name': r'error',
  'error_transport_rate_delay': r'$default_transport_rate_delay',
  'execution_directory_expansion_filter': r'1234567890!@%-_=+:,./abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ',
  'expand_owner_alias': r'no',
  'export_environment': r'TZ MAIL_CONFIG LANG',
  'fallback_transport': r'',
  'fallback_transport_maps': r'',
  'fast_flush_domains': r'$relay_domains',
  'fast_flush_purge_time': r'7d',
  'fast_flush_refresh_time': r'12h',
  'fault_injection_code': r'0',
  'flush_service_name': r'flush',
  'force_mime_input_conversion': r'no',
  'fork_attempts': r'5',
  'fork_delay': r'1s',
  'forward_expansion_filter': r'1234567890!@%-_=+:,./abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ',
  'forward_path': r'$home/.forward${recipient_delimiter}${extension}, $home/.forward',
  'frozen_delivered_to': r'yes',
  'full_name_encoding_charset': r'utf-8',
  'hash_queue_depth': r'1',
  'hash_queue_names': r'deferred, defer',
  'header_address_token_limit': r'10240',
  'header_checks': r'',
  'header_from_format': r'standard',
  'header_size_limit': r'102400',
  'helpful_warnings': r'yes',
  'home_mailbox': r'',
  'hopcount_limit': r'50',
  'html_directory': r'no',
  'ignore_mx_lookup_error': r'no',
  'ignore_srv_lookup_error': r'no',
  'import_environment': r'MAIL_CONFIG MAIL_DEBUG MAIL_LOGTAG TZ XAUTHORITY DISPLAY LANG=C POSTLOG_SERVICE POSTLOG_HOSTNAME',
  'in_flow_delay': r'1s',
  'inet_interfaces': r'all',
  'inet_protocols': r'all',
  'info_log_address_format': r'external',
  'initial_destination_concurrency': r'5',
  'internal_mail_filter_classes': r'',
  'invalid_hostname_reject_code': r'501',
  'ipc_idle': r'5s',
  'ipc_timeout': r'3600s',
  'ipc_ttl': r'1000s',
  'known_tcp_ports': r'lmtp=24, smtp=25, smtps=submissions=465, submission=587',
  'line_length_limit': r'2048',
  'lmdb_map_size': r'16777216',
  'lmtp_address_preference': r'any',
  'lmtp_address_verify_target': r'rcpt',
  'lmtp_assume_final': r'no',
  'lmtp_balance_inet_protocols': r'yes',
  'lmtp_bind_address': r'',
  'lmtp_bind_address6': r'',
  'lmtp_bind_address_enforce': r'no',
  'lmtp_body_checks': r'',
  'lmtp_cname_overrides_servername': r'no',
  'lmtp_connect_timeout': r'0s',
  'lmtp_connection_cache_destinations': r'',
  'lmtp_connection_cache_on_demand': r'yes',
  'lmtp_connection_cache_time_limit': r'2s',
  'lmtp_connection_reuse_count_limit': r'0',
  'lmtp_connection_reuse_time_limit': r'300s',
  'lmtp_data_done_timeout': r'600s',
  'lmtp_data_init_timeout': r'120s',
  'lmtp_data_xfer_timeout': r'180s',
  'lmtp_defer_if_no_mx_address_found': r'no',
  'lmtp_delivery_slot_cost': r'$default_delivery_slot_cost',
  'lmtp_delivery_slot_discount': r'$default_delivery_slot_discount',
  'lmtp_delivery_slot_loan': r'$default_delivery_slot_loan',
  'lmtp_delivery_status_filter': r'$default_delivery_status_filter',
  'lmtp_destination_concurrency_failed_cohort_limit': r'$default_destination_concurrency_failed_cohort_limit',
  'lmtp_destination_concurrency_limit': r'$default_destination_concurrency_limit',
  'lmtp_destination_concurrency_negative_feedback': r'$default_destination_concurrency_negative_feedback',
  'lmtp_destination_concurrency_positive_feedback': r'$default_destination_concurrency_positive_feedback',
  'lmtp_destination_rate_delay': r'$default_destination_rate_delay',
  'lmtp_destination_recipient_limit': r'$default_destination_recipient_limit',
  'lmtp_discard_lhlo_keyword_address_maps': r'',
  'lmtp_discard_lhlo_keywords': r'',
  'lmtp_dns_reply_filter': r'',
  'lmtp_dns_resolver_options': r'',
  'lmtp_dns_support_level': r'',
  'lmtp_enforce_tls': r'no',
  'lmtp_extra_recipient_limit': r'$default_extra_recipient_limit',
  'lmtp_fallback_relay': r'',
  'lmtp_generic_maps': r'',
  'lmtp_header_checks': r'',
  'lmtp_host_lookup': r'dns',
  'lmtp_initial_destination_concurrency': r'$initial_destination_concurrency',
  'lmtp_lhlo_name': r'$myhostname',
  'lmtp_lhlo_timeout': r'300s',
  'lmtp_line_length_limit': r'998',
  'lmtp_mail_timeout': r'300s',
  'lmtp_mime_header_checks': r'',
  'lmtp_min_data_rate': r'500',
  'lmtp_minimum_delivery_slots': r'$default_minimum_delivery_slots',
  'lmtp_mx_address_limit': r'5',
  'lmtp_mx_session_limit': r'2',
  'lmtp_nested_header_checks': r'',
  'lmtp_per_request_deadline': r'${lmtp_per_record_deadline?{$lmtp_per_record_deadline}:{no}}',
  'lmtp_pix_workaround_delay_time': r'10s',
  'lmtp_pix_workaround_maps': r'',
  'lmtp_pix_workaround_threshold_time': r'500s',
  'lmtp_pix_workarounds': r'disable_esmtp,delay_dotcrlf',
  'lmtp_quit_timeout': r'300s',
  'lmtp_quote_rfc821_envelope': r'yes',
  'lmtp_randomize_addresses': r'yes',
  'lmtp_rcpt_timeout': r'300s',
  'lmtp_recipient_limit': r'$default_recipient_limit',
  'lmtp_recipient_refill_delay': r'$default_recipient_refill_delay',
  'lmtp_recipient_refill_limit': r'$default_recipient_refill_limit',
  'lmtp_reply_filter': r'',
  'lmtp_rset_timeout': r'20s',
  'lmtp_sasl_auth_cache_name': r'',
  'lmtp_sasl_auth_cache_time': r'90d',
  'lmtp_sasl_auth_enable': r'no',
  'lmtp_sasl_auth_soft_bounce': r'yes',
  'lmtp_sasl_mechanism_filter': r'',
  'lmtp_sasl_password_maps': r'',
  'lmtp_sasl_password_result_delimiter': r':',
  'lmtp_sasl_path': r'',
  'lmtp_sasl_security_options': r'noplaintext, noanonymous',
  'lmtp_sasl_tls_security_options': r'$lmtp_sasl_security_options',
  'lmtp_sasl_tls_verified_security_options': r'$lmtp_sasl_tls_security_options',
  'lmtp_sasl_type': r'cyrus',
  'lmtp_send_dummy_mail_auth': r'no',
  'lmtp_send_xforward_command': r'no',
  'lmtp_sender_dependent_authentication': r'no',
  'lmtp_skip_5xx_greeting': r'yes',
  'lmtp_skip_quit_response': r'no',
  'lmtp_starttls_timeout': r'300s',
  'lmtp_tcp_port': r'24',
  'lmtp_tls_CAfile': r'',
  'lmtp_tls_CApath': r'',
  'lmtp_tls_block_early_mail_reply': r'no',
  'lmtp_tls_cert_file': r'',
  'lmtp_tls_chain_files': r'',
  'lmtp_tls_ciphers': r'medium',
  'lmtp_tls_connection_reuse': r'no',
  'lmtp_tls_dcert_file': r'',
  'lmtp_tls_dkey_file': r'$lmtp_tls_dcert_file',
  'lmtp_tls_eccert_file': r'',
  'lmtp_tls_eckey_file': r'$lmtp_tls_eccert_file',
  'lmtp_tls_enable_rpk': r'no',
  'lmtp_tls_enforce_peername': r'yes',
  'lmtp_tls_exclude_ciphers': r'',
  'lmtp_tls_fingerprint_cert_match': r'',
  'lmtp_tls_fingerprint_digest': r'${{$compatibility_level} <level {3.6} ? {sha1} : {sha256}}',
  'lmtp_tls_force_insecure_host_tlsa_lookup': r'no',
  'lmtp_tls_key_file': r'$lmtp_tls_cert_file',
  'lmtp_tls_loglevel': r'0',
  'lmtp_tls_mandatory_ciphers': r'medium',
  'lmtp_tls_mandatory_exclude_ciphers': r'',
  'lmtp_tls_mandatory_protocols': r'>=TLSv1',
  'lmtp_tls_note_starttls_offer': r'no',
  'lmtp_tls_per_site': r'',
  'lmtp_tls_policy_maps': r'',
  'lmtp_tls_protocols': r'>=TLSv1',
  'lmtp_tls_scert_verifydepth': r'9',
  'lmtp_tls_secure_cert_match': r'nexthop',
  'lmtp_tls_security_level': r'',
  'lmtp_tls_servername': r'',
  'lmtp_tls_session_cache_database': r'',
  'lmtp_tls_session_cache_timeout': r'3600s',
  'lmtp_tls_trust_anchor_file': r'',
  'lmtp_tls_verify_cert_match': r'hostname',
  'lmtp_tls_wrappermode': r'no',
  'lmtp_tlsrpt_enable': r'no',
  'lmtp_tlsrpt_skip_reused_handshakes': r'yes',
  'lmtp_tlsrpt_socket_name': r'',
  'lmtp_transport_rate_delay': r'$default_transport_rate_delay',
  'lmtp_use_tls': r'no',
  'lmtp_xforward_timeout': r'300s',
  'local_command_shell': r'',
  'local_delivery_slot_cost': r'$default_delivery_slot_cost',
  'local_delivery_slot_discount': r'$default_delivery_slot_discount',
  'local_delivery_slot_loan': r'$default_delivery_slot_loan',
  'local_delivery_status_filter': r'$default_delivery_status_filter',
  'local_destination_concurrency_failed_cohort_limit': r'$default_destination_concurrency_failed_cohort_limit',
  'local_destination_concurrency_limit': r'2',
  'local_destination_concurrency_negative_feedback': r'$default_destination_concurrency_negative_feedback',
  'local_destination_concurrency_positive_feedback': r'$default_destination_concurrency_positive_feedback',
  'local_destination_rate_delay': r'$default_destination_rate_delay',
  'local_destination_recipient_limit': r'1',
  'local_extra_recipient_limit': r'$default_extra_recipient_limit',
  'local_header_rewrite_clients': r'permit_inet_interfaces',
  'local_initial_destination_concurrency': r'$initial_destination_concurrency',
  'local_login_sender_maps': r'static:*',
  'local_minimum_delivery_slots': r'$default_minimum_delivery_slots',
  'local_recipient_limit': r'$default_recipient_limit',
  'local_recipient_maps': r'proxy:unix:passwd.byname $alias_maps',
  'local_recipient_refill_delay': r'$default_recipient_refill_delay',
  'local_recipient_refill_limit': r'$default_recipient_refill_limit',
  'local_transport': r'local:$myhostname',
  'local_transport_rate_delay': r'$default_transport_rate_delay',
  'luser_relay': r'',
  'mail_name': r'Postfix',
  'mail_owner': r'postfix',
  'mail_release_date': r'20250818',
  'mail_spool_directory': r'/var/mail',
  'mail_version': r'3.10.4',
  'mailbox_command': r'',
  'mailbox_command_maps': r'',
  'mailbox_delivery_lock': r'fcntl, dotlock',
  'mailbox_size_limit': r'51200000',
  'mailbox_transport': r'',
  'mailbox_transport_maps': r'',
  'maillog_file': r'',
  'maillog_file_compressor': r'gzip',
  'maillog_file_permissions': r'0600',
  'maillog_file_prefixes': r'/var, /dev/stdout',
  'maillog_file_rotate_suffix': r'%Y%m%d-%H%M%S',
  'mailq_path': r'/usr/bin/mailq',
  'manpage_directory': r'/usr/share/man',
  'maps_rbl_domains': r'',
  'maps_rbl_reject_code': r'554',
  'masquerade_classes': r'envelope_sender, header_sender, header_recipient',
  'masquerade_domains': r'',
  'masquerade_exceptions': r'',
  'master_service_disable': r'',
  'max_idle': r'100s',
  'max_use': r'100',
  'maximal_backoff_time': r'4000s',
  'maximal_queue_lifetime': r'5d',
  'message_drop_headers': r'bcc, content-length, resent-bcc, return-path',
  'message_reject_characters': r'',
  'message_size_limit': r'10240000',
  'message_strip_characters': r'',
  'meta_directory': r'/usr/lib/postfix',
  'milter_command_timeout': r'30s',
  'milter_connect_macros': r'j {daemon_name} {daemon_addr} v _',
  'milter_connect_timeout': r'30s',
  'milter_content_timeout': r'300s',
  'milter_data_macros': r'i',
  'milter_default_action': r'tempfail',
  'milter_end_of_data_macros': r'i',
  'milter_end_of_header_macros': r'i',
  'milter_header_checks': r'',
  'milter_helo_macros': r'{tls_version} {cipher} {cipher_bits} {cert_subject} {cert_issuer}',
  'milter_macro_daemon_name': r'$myhostname',
  'milter_macro_defaults': r'',
  'milter_macro_v': r'$mail_name $mail_version',
  'milter_mail_macros': r'i {auth_type} {auth_authen} {auth_author} {mail_addr} {mail_host} {mail_mailer}',
  'milter_protocol': r'6',
  'milter_rcpt_macros': r'i {rcpt_addr} {rcpt_host} {rcpt_mailer}',
  'milter_unknown_command_macros': r'',
  'mime_boundary_length_limit': r'2048',
  'mime_header_checks': r'$header_checks',
  'mime_nesting_limit': r'100',
  'minimal_backoff_time': r'300s',
  'multi_instance_directories': r'',
  'multi_instance_enable': r'no',
  'multi_instance_group': r'',
  'multi_instance_name': r'',
  'multi_instance_wrapper': r'',
  'multi_recipient_bounce_reject_code': r'550',
  'mydestination': r'$myhostname, localhost.$mydomain, localhost',
  'mydomain': r'home.nordisch.org',
  'myhostname': r'woody.home.nordisch.org',
  'mynetworks': r'127.0.0.1/32 192.168.178.45/32 192.168.1.3/32 192.168.3.6/32 172.31.0.2/32 192.168.4.9/32 169.254.167.232/32 192.168.90.225/32 169.254.234.173/32 192.168.228.17/32 169.254.253.155/32 192.168.106.209/32 169.254.238.135/32 192.168.184.17/32 [::1]/128 [fd38:4b8e:27eb:0:befc:e7ff:feb3:12cc]/128 [2a02:810d:be80:1e00:befc:e7ff:feb3:12cc]/128 [fe80::befc:e7ff:feb3:12cc]/128 [2003:e3:7f02:2100::d]/128 [fe80::62cf:84ff:fe8a:7db4]/128 [fe80::388b:21ff:fe7c:3ed1]/128 [fe80::28f7:adff:fedb:7ae0]/128 [fe80::e861:9fff:feca:3eab]/128 [fe80::60f5:2fff:fe1d:1e9c]/128',
  'mynetworks_style': r'${{$compatibility_level} <level {2} ? {subnet} : {host}}',
  'myorigin': r'$myhostname',
  'nested_header_checks': r'$header_checks',
  'newaliases_path': r'/usr/bin/newaliases',
  'non_fqdn_reject_code': r'504',
  'non_smtpd_milters': r'',
  'notify_classes': r'resource, software',
  'openssl_path': r'openssl',
  'owner_request_special': r'yes',
  'parent_domain_matches_subdomains': r'debug_peer_list,fast_flush_domains,mynetworks,permit_mx_backup_networks,qmqpd_authorized_clients,relay_domains,smtpd_access_maps',
  'permit_mx_backup_networks': r'',
  'pickup_service_name': r'pickup',
  'pipe_delivery_status_filter': r'$default_delivery_status_filter',
  'plaintext_reject_code': r'450',
  'postlog_service_name': r'postlog',
  'postlogd_watchdog_timeout': r'10s',
  'postmulti_control_commands': r'reload flush',
  'postmulti_start_commands': r'start',
  'postmulti_stop_commands': r'stop abort drain quick-stop',
  'postscreen_access_list': r'permit_mynetworks',
  'postscreen_allowlist_interfaces': r'${postscreen_whitelist_interfaces?{$postscreen_whitelist_interfaces}:{static:all}}',
  'postscreen_bare_newline_action': r'ignore',
  'postscreen_bare_newline_enable': r'no',
  'postscreen_bare_newline_ttl': r'30d',
  'postscreen_cache_cleanup_interval': r'12h',
  'postscreen_cache_map': r'lmdb:$data_directory/postscreen_cache',
  'postscreen_cache_retention_time': r'7d',
  'postscreen_client_connection_count_limit': r'$smtpd_client_connection_count_limit',
  'postscreen_command_count_limit': r'20',
  'postscreen_command_filter': r'',
  'postscreen_command_time_limit': r'${stress?{10}:{300}}s',
  'postscreen_denylist_action': r'${postscreen_blacklist_action?{$postscreen_blacklist_action}:{ignore}}',
  'postscreen_disable_vrfy_command': r'$disable_vrfy_command',
  'postscreen_discard_ehlo_keyword_address_maps': r'$smtpd_discard_ehlo_keyword_address_maps',
  'postscreen_discard_ehlo_keywords': r'$smtpd_discard_ehlo_keywords',
  'postscreen_dnsbl_action': r'ignore',
  'postscreen_dnsbl_allowlist_threshold': r'${postscreen_dnsbl_whitelist_threshold?{$postscreen_dnsbl_whitelist_threshold}:{0}}',
  'postscreen_dnsbl_max_ttl': r'${postscreen_dnsbl_ttl?{$postscreen_dnsbl_ttl}:{1}}h',
  'postscreen_dnsbl_min_ttl': r'60s',
  'postscreen_dnsbl_reply_map': r'',
  'postscreen_dnsbl_sites': r'',
  'postscreen_dnsbl_threshold': r'1',
  'postscreen_dnsbl_timeout': r'10s',
  'postscreen_enforce_tls': r'$smtpd_enforce_tls',
  'postscreen_expansion_filter': r'$smtpd_expansion_filter',
  'postscreen_forbidden_commands': r'$smtpd_forbidden_commands',
  'postscreen_greet_action': r'ignore',
  'postscreen_greet_banner': r'$smtpd_banner',
  'postscreen_greet_ttl': r'1d',
  'postscreen_greet_wait': r'${stress?{2}:{6}}s',
  'postscreen_helo_required': r'$smtpd_helo_required',
  'postscreen_non_smtp_command_action': r'drop',
  'postscreen_non_smtp_command_enable': r'no',
  'postscreen_non_smtp_command_ttl': r'30d',
  'postscreen_pipelining_action': r'enforce',
  'postscreen_pipelining_enable': r'no',
  'postscreen_pipelining_ttl': r'30d',
  'postscreen_post_queue_limit': r'$default_process_limit',
  'postscreen_pre_queue_limit': r'$default_process_limit',
  'postscreen_reject_footer': r'$smtpd_reject_footer',
  'postscreen_reject_footer_maps': r'$smtpd_reject_footer_maps',
  'postscreen_tls_security_level': r'$smtpd_tls_security_level',
  'postscreen_upstream_proxy_protocol': r'',
  'postscreen_upstream_proxy_timeout': r'5s',
  'postscreen_use_tls': r'$smtpd_use_tls',
  'postscreen_watchdog_timeout': r'10s',
  'prepend_delivered_header': r'command, file, forward',
  'process_id': r'1345961',
  'process_id_directory': r'pid',
  'process_name': r'postconf',
  'propagate_unmatched_extensions': r'canonical, virtual',
  'proxy_interfaces': r'',
  'proxy_read_maps': r'$local_recipient_maps $mydestination $virtual_alias_maps $virtual_alias_domains $virtual_mailbox_maps $virtual_mailbox_domains $relay_recipient_maps $relay_domains $canonical_maps $sender_canonical_maps $recipient_canonical_maps $relocated_maps $transport_maps $mynetworks $smtpd_sender_login_maps $sender_bcc_maps $recipient_bcc_maps $smtp_generic_maps $lmtp_generic_maps $alias_maps $smtpd_client_restrictions $smtpd_helo_restrictions $smtpd_sender_restrictions $smtpd_relay_restrictions $smtpd_recipient_restrictions $address_verify_sender_dependent_default_transport_maps $address_verify_sender_dependent_relayhost_maps $address_verify_transport_maps $fallback_transport_maps $lmtp_discard_lhlo_keyword_address_maps $lmtp_pix_workaround_maps $lmtp_sasl_password_maps $lmtp_tls_policy_maps $mailbox_command_maps $mailbox_transport_maps $postscreen_discard_ehlo_keyword_address_maps $rbl_reply_maps $sender_dependent_default_transport_maps $sender_dependent_relayhost_maps $smtp_discard_ehlo_keyword_address_maps $smtp_pix_workaround_maps $smtp_sasl_password_maps $smtp_tls_policy_maps $smtpd_discard_ehlo_keyword_address_maps $smtpd_milter_maps $virtual_gid_maps $virtual_uid_maps $local_login_sender_maps $postscreen_reject_footer_maps $smtpd_reject_footer_maps $tls_server_sni_maps $tlsproxy_client_policy_maps $default_delivery_status_filter $lmtp_delivery_status_filter $lmtp_dns_reply_filter $lmtp_reply_filter $local_delivery_status_filter $pipe_delivery_status_filter $postscreen_command_filter $smtp_delivery_status_filter $smtp_dns_reply_filter $smtp_reply_filter $smtpd_command_filter $smtpd_dns_reply_filter $virtual_delivery_status_filter $body_checks $header_checks $lmtp_body_checks $lmtp_header_checks $lmtp_mime_header_checks $lmtp_nested_header_checks $milter_header_checks $mime_header_checks $nested_header_checks $smtp_body_checks $smtp_header_checks $smtp_mime_header_checks $smtp_nested_header_checks',
  'proxy_write_maps': r'$smtp_sasl_auth_cache_name $lmtp_sasl_auth_cache_name $address_verify_map $postscreen_cache_map',
  'proxymap_service_name': r'proxymap',
  'proxywrite_service_name': r'proxywrite',
  'qmgr_clog_warn_time': r'300s',
  'qmgr_daemon_timeout': r'1000s',
  'qmgr_fudge_factor': r'100',
  'qmgr_ipc_timeout': r'60s',
  'qmgr_message_active_limit': r'20000',
  'qmgr_message_recipient_limit': r'20000',
  'qmgr_message_recipient_minimum': r'10',
  'qmqpd_authorized_clients': r'',
  'qmqpd_client_port_logging': r'no',
  'qmqpd_error_delay': r'1s',
  'qmqpd_timeout': r'300s',
  'queue_directory': r'/var/spool/postfix',
  'queue_file_attribute_count_limit': r'100',
  'queue_minfree': r'0',
  'queue_run_delay': r'300s',
  'queue_service_name': r'qmgr',
  'rbl_reply_maps': r'',
  'readme_directory': r'/usr/share/doc/packages/postfix-doc/README_FILES',
  'receive_override_options': r'',
  'recipient_bcc_maps': r'',
  'recipient_canonical_classes': r'envelope_recipient, header_recipient',
  'recipient_canonical_maps': r'',
  'recipient_delimiter': r'',
  'reject_code': r'554',
  'reject_tempfail_action': r'defer_if_permit',
  'relay_clientcerts': r'',
  'relay_delivery_slot_cost': r'$default_delivery_slot_cost',
  'relay_delivery_slot_discount': r'$default_delivery_slot_discount',
  'relay_delivery_slot_loan': r'$default_delivery_slot_loan',
  'relay_destination_concurrency_failed_cohort_limit': r'$default_destination_concurrency_failed_cohort_limit',
  'relay_destination_concurrency_limit': r'$default_destination_concurrency_limit',
  'relay_destination_concurrency_negative_feedback': r'$default_destination_concurrency_negative_feedback',
  'relay_destination_concurrency_positive_feedback': r'$default_destination_concurrency_positive_feedback',
  'relay_destination_rate_delay': r'$default_destination_rate_delay',
  'relay_destination_recipient_limit': r'$default_destination_recipient_limit',
  'relay_domains': r'${{$compatibility_level} <level {2} ? {$mydestination} : {}}',
  'relay_domains_reject_code': r'554',
  'relay_extra_recipient_limit': r'$default_extra_recipient_limit',
  'relay_initial_destination_concurrency': r'$initial_destination_concurrency',
  'relay_minimum_delivery_slots': r'$default_minimum_delivery_slots',
  'relay_recipient_limit': r'$default_recipient_limit',
  'relay_recipient_maps': r'',
  'relay_recipient_refill_delay': r'$default_recipient_refill_delay',
  'relay_recipient_refill_limit': r'$default_recipient_refill_limit',
  'relay_transport': r'relay',
  'relay_transport_rate_delay': r'$default_transport_rate_delay',
  'relayhost': r'',
  'relocated_maps': r'',
  'remote_header_rewrite_domain': r'',
  'require_home_directory': r'no',
  'reset_owner_alias': r'no',
  'resolve_dequoted_address': r'yes',
  'resolve_null_domain': r'no',
  'resolve_numeric_domain': r'no',
  'respectful_logging': r'${{$compatibility_level} <level {3.6} ? {no} : {yes}}',
  'retry_delivery_slot_cost': r'$default_delivery_slot_cost',
  'retry_delivery_slot_discount': r'$default_delivery_slot_discount',
  'retry_delivery_slot_loan': r'$default_delivery_slot_loan',
  'retry_destination_concurrency_failed_cohort_limit': r'$default_destination_concurrency_failed_cohort_limit',
  'retry_destination_concurrency_limit': r'$default_destination_concurrency_limit',
  'retry_destination_concurrency_negative_feedback': r'$default_destination_concurrency_negative_feedback',
  'retry_destination_concurrency_positive_feedback': r'$default_destination_concurrency_positive_feedback',
  'retry_destination_rate_delay': r'$default_destination_rate_delay',
  'retry_destination_recipient_limit': r'$default_destination_recipient_limit',
  'retry_extra_recipient_limit': r'$default_extra_recipient_limit',
  'retry_initial_destination_concurrency': r'$initial_destination_concurrency',
  'retry_minimum_delivery_slots': r'$default_minimum_delivery_slots',
  'retry_recipient_limit': r'$default_recipient_limit',
  'retry_recipient_refill_delay': r'$default_recipient_refill_delay',
  'retry_recipient_refill_limit': r'$default_recipient_refill_limit',
  'retry_transport_rate_delay': r'$default_transport_rate_delay',
  'rewrite_service_name': r'rewrite',
  'sample_directory': r'/etc/postfix',
  'send_cyrus_sasl_authzid': r'no',
  'sender_bcc_maps': r'',
  'sender_canonical_classes': r'envelope_sender, header_sender',
  'sender_canonical_maps': r'',
  'sender_dependent_default_transport_maps': r'',
  'sender_dependent_relayhost_maps': r'',
  'sendmail_fix_line_endings': r'always',
  'sendmail_path': r'/usr/sbin/sendmail',
  'service_name': r'',
  'service_throttle_time': r'60s',
  'setgid_group': r'postdrop',
  'shlib_directory': r'/usr/lib/postfix',
  'show_user_unknown_table_name': r'yes',
  'showq_service_name': r'showq',
  'smtp_address_preference': r'any',
  'smtp_address_verify_target': r'rcpt',
  'smtp_always_send_ehlo': r'yes',
  'smtp_balance_inet_protocols': r'yes',
  'smtp_bind_address': r'',
  'smtp_bind_address6': r'',
  'smtp_bind_address_enforce': r'no',
  'smtp_body_checks': r'',
  'smtp_cname_overrides_servername': r'no',
  'smtp_connect_timeout': r'30s',
  'smtp_connection_cache_destinations': r'',
  'smtp_connection_cache_on_demand': r'yes',
  'smtp_connection_cache_time_limit': r'2s',
  'smtp_connection_reuse_count_limit': r'0',
  'smtp_connection_reuse_time_limit': r'300s',
  'smtp_data_done_timeout': r'600s',
  'smtp_data_init_timeout': r'120s',
  'smtp_data_xfer_timeout': r'180s',
  'smtp_defer_if_no_mx_address_found': r'no',
  'smtp_delivery_slot_cost': r'$default_delivery_slot_cost',
  'smtp_delivery_slot_discount': r'$default_delivery_slot_discount',
  'smtp_delivery_slot_loan': r'$default_delivery_slot_loan',
  'smtp_delivery_status_filter': r'$default_delivery_status_filter',
  'smtp_destination_concurrency_failed_cohort_limit': r'$default_destination_concurrency_failed_cohort_limit',
  'smtp_destination_concurrency_limit': r'$default_destination_concurrency_limit',
  'smtp_destination_concurrency_negative_feedback': r'$default_destination_concurrency_negative_feedback',
  'smtp_destination_concurrency_positive_feedback': r'$default_destination_concurrency_positive_feedback',
  'smtp_destination_rate_delay': r'$default_destination_rate_delay',
  'smtp_destination_recipient_limit': r'$default_destination_recipient_limit',
  'smtp_discard_ehlo_keyword_address_maps': r'',
  'smtp_discard_ehlo_keywords': r'',
  'smtp_dns_reply_filter': r'',
  'smtp_dns_resolver_options': r'',
  'smtp_dns_support_level': r'',
  'smtp_enforce_tls': r'no',
  'smtp_extra_recipient_limit': r'$default_extra_recipient_limit',
  'smtp_fallback_relay': r'$fallback_relay',
  'smtp_generic_maps': r'',
  'smtp_header_checks': r'',
  'smtp_helo_name': r'$myhostname',
  'smtp_helo_timeout': r'300s',
  'smtp_host_lookup': r'dns',
  'smtp_initial_destination_concurrency': r'$initial_destination_concurrency',
  'smtp_line_length_limit': r'998',
  'smtp_mail_timeout': r'300s',
  'smtp_mime_header_checks': r'',
  'smtp_min_data_rate': r'500',
  'smtp_minimum_delivery_slots': r'$default_minimum_delivery_slots',
  'smtp_mx_address_limit': r'5',
  'smtp_mx_session_limit': r'2',
  'smtp_nested_header_checks': r'',
  'smtp_never_send_ehlo': r'no',
  'smtp_per_request_deadline': r'${smtp_per_record_deadline?{$smtp_per_record_deadline}:{no}}',
  'smtp_pix_workaround_delay_time': r'10s',
  'smtp_pix_workaround_maps': r'',
  'smtp_pix_workaround_threshold_time': r'500s',
  'smtp_pix_workarounds': r'disable_esmtp,delay_dotcrlf',
  'smtp_quit_timeout': r'300s',
  'smtp_quote_rfc821_envelope': r'yes',
  'smtp_randomize_addresses': r'yes',
  'smtp_rcpt_timeout': r'300s',
  'smtp_recipient_limit': r'$default_recipient_limit',
  'smtp_recipient_refill_delay': r'$default_recipient_refill_delay',
  'smtp_recipient_refill_limit': r'$default_recipient_refill_limit',
  'smtp_reply_filter': r'',
  'smtp_rset_timeout': r'20s',
  'smtp_sasl_auth_cache_name': r'',
  'smtp_sasl_auth_cache_time': r'90d',
  'smtp_sasl_auth_enable': r'no',
  'smtp_sasl_auth_soft_bounce': r'yes',
  'smtp_sasl_mechanism_filter': r'',
  'smtp_sasl_password_maps': r'',
  'smtp_sasl_password_result_delimiter': r':',
  'smtp_sasl_path': r'',
  'smtp_sasl_security_options': r'noplaintext, noanonymous',
  'smtp_sasl_tls_security_options': r'$smtp_sasl_security_options',
  'smtp_sasl_tls_verified_security_options': r'$smtp_sasl_tls_security_options',
  'smtp_sasl_type': r'cyrus',
  'smtp_send_dummy_mail_auth': r'no',
  'smtp_send_xforward_command': r'no',
  'smtp_sender_dependent_authentication': r'no',
  'smtp_skip_5xx_greeting': r'yes',
  'smtp_skip_quit_response': r'yes',
  'smtp_starttls_timeout': r'300s',
  'smtp_tcp_port': r'smtp',
  'smtp_tls_CAfile': r'',
  'smtp_tls_CApath': r'',
  'smtp_tls_block_early_mail_reply': r'no',
  'smtp_tls_cert_file': r'',
  'smtp_tls_chain_files': r'',
  'smtp_tls_ciphers': r'medium',
  'smtp_tls_connection_reuse': r'no',
  'smtp_tls_dane_insecure_mx_policy': r'dane',
  'smtp_tls_dcert_file': r'',
  'smtp_tls_dkey_file': r'$smtp_tls_dcert_file',
  'smtp_tls_eccert_file': r'',
  'smtp_tls_eckey_file': r'$smtp_tls_eccert_file',
  'smtp_tls_enable_rpk': r'no',
  'smtp_tls_enforce_peername': r'yes',
  'smtp_tls_exclude_ciphers': r'',
  'smtp_tls_fingerprint_cert_match': r'',
  'smtp_tls_fingerprint_digest': r'${{$compatibility_level} <level {3.6} ? {sha1} : {sha256}}',
  'smtp_tls_force_insecure_host_tlsa_lookup': r'no',
  'smtp_tls_key_file': r'$smtp_tls_cert_file',
  'smtp_tls_loglevel': r'0',
  'smtp_tls_mandatory_ciphers': r'medium',
  'smtp_tls_mandatory_exclude_ciphers': r'',
  'smtp_tls_mandatory_protocols': r'>=TLSv1',
  'smtp_tls_note_starttls_offer': r'no',
  'smtp_tls_per_site': r'',
  'smtp_tls_policy_maps': r'',
  'smtp_tls_protocols': r'>=TLSv1',
  'smtp_tls_scert_verifydepth': r'9',
  'smtp_tls_secure_cert_match': r'nexthop, dot-nexthop',
  'smtp_tls_security_level': r'',
  'smtp_tls_servername': r'',
  'smtp_tls_session_cache_database': r'',
  'smtp_tls_session_cache_timeout': r'3600s',
  'smtp_tls_trust_anchor_file': r'',
  'smtp_tls_verify_cert_match': r'hostname',
  'smtp_tls_wrappermode': r'no',
  'smtp_tlsrpt_enable': r'no',
  'smtp_tlsrpt_skip_reused_handshakes': r'yes',
  'smtp_tlsrpt_socket_name': r'',
  'smtp_transport_rate_delay': r'$default_transport_rate_delay',
  'smtp_use_tls': r'no',
  'smtp_xforward_timeout': r'300s',
  'smtpd_authorized_verp_clients': r'$authorized_verp_clients',
  'smtpd_authorized_xclient_hosts': r'',
  'smtpd_authorized_xforward_hosts': r'',
  'smtpd_banner': r'$myhostname ESMTP $mail_name',
  'smtpd_client_auth_rate_limit': r'0',
  'smtpd_client_connection_count_limit': r'50',
  'smtpd_client_connection_rate_limit': r'0',
  'smtpd_client_event_limit_exceptions': r'${smtpd_client_connection_limit_exceptions:$mynetworks}',
  'smtpd_client_ipv4_prefix_length': r'32',
  'smtpd_client_ipv6_prefix_length': r'84',
  'smtpd_client_message_rate_limit': r'0',
  'smtpd_client_new_tls_session_rate_limit': r'0',
  'smtpd_client_port_logging': r'no',
  'smtpd_client_recipient_rate_limit': r'0',
  'smtpd_client_restrictions': r'',
  'smtpd_command_filter': r'',
  'smtpd_data_restrictions': r'',
  'smtpd_delay_open_until_valid_rcpt': r'yes',
  'smtpd_delay_reject': r'yes',
  'smtpd_discard_ehlo_keyword_address_maps': r'',
  'smtpd_discard_ehlo_keywords': r'',
  'smtpd_dns_reply_filter': r'',
  'smtpd_end_of_data_restrictions': r'',
  'smtpd_enforce_tls': r'no',
  'smtpd_error_sleep_time': r'1s',
  'smtpd_etrn_restrictions': r'',
  'smtpd_expansion_filter': r"""\t\40!"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~""",
  'smtpd_forbid_bare_newline': r'normalize',
  'smtpd_forbid_bare_newline_exclusions': r'$mynetworks',
  'smtpd_forbid_bare_newline_reject_code': r'550',
  'smtpd_forbid_unauth_pipelining': r'yes',
  'smtpd_forbidden_commands': r'CONNECT GET POST regexp:{{/^[^A-Z]/ Bogus}}',
  'smtpd_hard_error_limit': r'${stress?{1}:{20}}',
  'smtpd_helo_required': r'no',
  'smtpd_helo_restrictions': r'',
  'smtpd_hide_client_session': r'no',
  'smtpd_history_flush_threshold': r'100',
  'smtpd_junk_command_limit': r'${stress?{1}:{100}}',
  'smtpd_log_access_permit_actions': r'',
  'smtpd_milter_maps': r'',
  'smtpd_milters': r'',
  'smtpd_min_data_rate': r'500',
  'smtpd_noop_commands': r'',
  'smtpd_null_access_lookup_key': r'<>',
  'smtpd_peername_lookup': r'yes',
  'smtpd_per_request_deadline': r'${smtpd_per_record_deadline?{$smtpd_per_record_deadline}:{${stress?{yes}:{no}}}}',
  'smtpd_policy_service_default_action': r'451 4.3.5 Server configuration problem',
  'smtpd_policy_service_max_idle': r'300s',
  'smtpd_policy_service_max_ttl': r'1000s',
  'smtpd_policy_service_policy_context': r'',
  'smtpd_policy_service_request_limit': r'0',
  'smtpd_policy_service_retry_delay': r'1s',
  'smtpd_policy_service_timeout': r'100s',
  'smtpd_policy_service_try_limit': r'2',
  'smtpd_proxy_ehlo': r'$myhostname',
  'smtpd_proxy_filter': r'',
  'smtpd_proxy_options': r'',
  'smtpd_proxy_timeout': r'100s',
  'smtpd_recipient_limit': r'1000',
  'smtpd_recipient_overshoot_limit': r'1000',
  'smtpd_recipient_restrictions': r'',
  'smtpd_reject_footer': r'',
  'smtpd_reject_footer_maps': r'',
  'smtpd_reject_unlisted_recipient': r'yes',
  'smtpd_reject_unlisted_sender': r'no',
  'smtpd_relay_before_recipient_restrictions': r'${{$compatibility_level} <level {3.6} ? {no} : {yes}}',
  'smtpd_relay_restrictions': r'${{$compatibility_level} <level {1} ? {} : {permit_mynetworks, permit_sasl_authenticated, defer_unauth_destination}}',
  'smtpd_restriction_classes': r'',
  'smtpd_sasl_auth_enable': r'no',
  'smtpd_sasl_authenticated_header': r'no',
  'smtpd_sasl_exceptions_networks': r'',
  'smtpd_sasl_local_domain': r'',
  'smtpd_sasl_mechanism_filter': r'!external, static:rest',
  'smtpd_sasl_path': r'smtpd',
  'smtpd_sasl_response_limit': r'12288',
  'smtpd_sasl_security_options': r'noanonymous',
  'smtpd_sasl_service': r'smtp',
  'smtpd_sasl_tls_security_options': r'$smtpd_sasl_security_options',
  'smtpd_sasl_type': r'cyrus',
  'smtpd_sender_login_maps': r'',
  'smtpd_sender_restrictions': r'',
  'smtpd_service_name': r'smtpd',
  'smtpd_soft_error_limit': r'10',
  'smtpd_starttls_timeout': r'${stress?{10}:{300}}s',
  'smtpd_timeout': r'${stress?{10}:{300}}s',
  'smtpd_tls_CAfile': r'',
  'smtpd_tls_CApath': r'',
  'smtpd_tls_always_issue_session_ids': r'yes',
  'smtpd_tls_ask_ccert': r'no',
  'smtpd_tls_auth_only': r'no',
  'smtpd_tls_ccert_verifydepth': r'9',
  'smtpd_tls_cert_file': r'',
  'smtpd_tls_chain_files': r'',
  'smtpd_tls_ciphers': r'medium',
  'smtpd_tls_dcert_file': r'',
  'smtpd_tls_dh1024_param_file': r'',
  'smtpd_tls_dh512_param_file': r'',
  'smtpd_tls_dkey_file': r'$smtpd_tls_dcert_file',
  'smtpd_tls_eccert_file': r'',
  'smtpd_tls_eckey_file': r'$smtpd_tls_eccert_file',
  'smtpd_tls_eecdh_grade': r'auto',
  'smtpd_tls_enable_rpk': r'no',
  'smtpd_tls_exclude_ciphers': r'',
  'smtpd_tls_fingerprint_digest': r'${{$compatibility_level} <level {3.6} ? {sha1} : {sha256}}',
  'smtpd_tls_key_file': r'$smtpd_tls_cert_file',
  'smtpd_tls_loglevel': r'0',
  'smtpd_tls_mandatory_ciphers': r'medium',
  'smtpd_tls_mandatory_exclude_ciphers': r'',
  'smtpd_tls_mandatory_protocols': r'>=TLSv1',
  'smtpd_tls_protocols': r'>=TLSv1',
  'smtpd_tls_received_header': r'no',
  'smtpd_tls_req_ccert': r'no',
  'smtpd_tls_security_level': r'',
  'smtpd_tls_session_cache_database': r'',
  'smtpd_tls_session_cache_timeout': r'3600s',
  'smtpd_tls_wrappermode': r'no',
  'smtpd_upstream_proxy_protocol': r'',
  'smtpd_upstream_proxy_timeout': r'5s',
  'smtpd_use_tls': r'no',
  'smtputf8_autodetect_classes': r'sendmail, verify',
  'smtputf8_enable': r'${{$compatibility_level} <level {1} ? {no} : {yes}}',
  'socketmap_max_reply_size': r'100000',
  'soft_bounce': r'no',
  'stale_lock_time': r'500s',
  'stress': r'',
  'strict_7bit_headers': r'no',
  'strict_8bitmime': r'no',
  'strict_8bitmime_body': r'no',
  'strict_mailbox_ownership': r'yes',
  'strict_mime_encoding_domain': r'no',
  'strict_rfc821_envelopes': r'no',
  'strict_smtputf8': r'no',
  'sun_mailtool_compatibility': r'no',
  'swap_bangpath': r'yes',
  'syslog_facility': r'mail',
  'syslog_name': r'${multi_instance_name?{$multi_instance_name}:{postfix}}',
  'tcp_windowsize': r'0',
  'tls_append_default_CA': r'no',
  'tls_config_file': r'default',
  'tls_config_name': r'',
  'tls_daemon_random_bytes': r'32',
  'tls_dane_digests': r'sha512 sha256',
  'tls_disable_workarounds': r'',
  'tls_eecdh_auto_curves': r'X25519 X448 prime256v1 secp384r1 secp521r1',
  'tls_eecdh_strong_curve': r'prime256v1',
  'tls_eecdh_ultra_curve': r'secp384r1',
  'tls_export_cipherlist': r'',
  'tls_fast_shutdown_enable': r'yes',
  'tls_ffdhe_auto_groups': r'ffdhe2048 ffdhe3072',
  'tls_high_cipherlist': r'aNULL:-aNULL:HIGH:!SEED:!IDEA:!3DES:!RC2:!RC4:!RC5:!kDH:!kECDH:!aDSS:!MD5:@STRENGTH',
  'tls_legacy_public_key_fingerprints': r'no',
  'tls_low_cipherlist': r'',
  'tls_medium_cipherlist': r'aNULL:-aNULL:HIGH:MEDIUM:!SEED:!IDEA:!3DES:!RC2:!RC4:!RC5:!kDH:!kECDH:!aDSS:!MD5:+RC4:@STRENGTH',
  'tls_null_cipherlist': r'eNULL:!kDH:!kECDH:!aDSS:!MD5:!aNULL',
  'tls_preempt_cipherlist': r'no',
  'tls_random_bytes': r'32',
  'tls_random_exchange_name': r'${data_directory}/prng_exch',
  'tls_random_prng_update_period': r'3600s',
  'tls_random_reseed_period': r'3600s',
  'tls_random_source': r'dev:/dev/urandom',
  'tls_required_enable': r'yes',
  'tls_server_sni_maps': r'',
  'tls_session_ticket_cipher': r'aes-256-cbc',
  'tls_ssl_options': r'',
  'tls_wildcard_matches_multiple_labels': r'yes',
  'tlsmgr_service_name': r'tlsmgr',
  'tlsproxy_client_CAfile': r'$smtp_tls_CAfile',
  'tlsproxy_client_CApath': r'$smtp_tls_CApath',
  'tlsproxy_client_cert_file': r'$smtp_tls_cert_file',
  'tlsproxy_client_chain_files': r'$smtp_tls_chain_files',
  'tlsproxy_client_dcert_file': r'$smtp_tls_dcert_file',
  'tlsproxy_client_dkey_file': r'$smtp_tls_dkey_file',
  'tlsproxy_client_eccert_file': r'$smtp_tls_eccert_file',
  'tlsproxy_client_eckey_file': r'$smtp_tls_eckey_file',
  'tlsproxy_client_enforce_tls': r'$smtp_enforce_tls',
  'tlsproxy_client_fingerprint_digest': r'$smtp_tls_fingerprint_digest',
  'tlsproxy_client_key_file': r'$smtp_tls_key_file',
  'tlsproxy_client_loglevel': r'$smtp_tls_loglevel',
  'tlsproxy_client_loglevel_parameter': r'smtp_tls_loglevel',
  'tlsproxy_client_per_site': r'$smtp_tls_per_site',
  'tlsproxy_client_policy_maps': r'${tlsproxy_client_policy?{$tlsproxy_client_policy}:{$smtp_tls_policy_maps}}',
  'tlsproxy_client_scert_verifydepth': r'$smtp_tls_scert_verifydepth',
  'tlsproxy_client_security_level': r'${tlsproxy_client_level?{$tlsproxy_client_level}:{$smtp_tls_security_level}}',
  'tlsproxy_client_use_tls': r'$smtp_use_tls',
  'tlsproxy_enforce_tls': r'$smtpd_enforce_tls',
  'tlsproxy_service_name': r'tlsproxy',
  'tlsproxy_tls_CAfile': r'$smtpd_tls_CAfile',
  'tlsproxy_tls_CApath': r'$smtpd_tls_CApath',
  'tlsproxy_tls_always_issue_session_ids': r'$smtpd_tls_always_issue_session_ids',
  'tlsproxy_tls_ask_ccert': r'$smtpd_tls_ask_ccert',
  'tlsproxy_tls_ccert_verifydepth': r'$smtpd_tls_ccert_verifydepth',
  'tlsproxy_tls_cert_file': r'$smtpd_tls_cert_file',
  'tlsproxy_tls_chain_files': r'$smtpd_tls_chain_files',
  'tlsproxy_tls_ciphers': r'$smtpd_tls_ciphers',
  'tlsproxy_tls_dcert_file': r'$smtpd_tls_dcert_file',
  'tlsproxy_tls_dh1024_param_file': r'$smtpd_tls_dh1024_param_file',
  'tlsproxy_tls_dh512_param_file': r'$smtpd_tls_dh512_param_file',
  'tlsproxy_tls_dkey_file': r'$smtpd_tls_dkey_file',
  'tlsproxy_tls_eccert_file': r'$smtpd_tls_eccert_file',
  'tlsproxy_tls_eckey_file': r'$smtpd_tls_eckey_file',
  'tlsproxy_tls_eecdh_grade': r'$smtpd_tls_eecdh_grade',
  'tlsproxy_tls_enable_rpk': r'$smtpd_tls_enable_rpk',
  'tlsproxy_tls_exclude_ciphers': r'$smtpd_tls_exclude_ciphers',
  'tlsproxy_tls_fingerprint_digest': r'$smtpd_tls_fingerprint_digest',
  'tlsproxy_tls_key_file': r'$smtpd_tls_key_file',
  'tlsproxy_tls_loglevel': r'$smtpd_tls_loglevel',
  'tlsproxy_tls_mandatory_ciphers': r'$smtpd_tls_mandatory_ciphers',
  'tlsproxy_tls_mandatory_exclude_ciphers': r'$smtpd_tls_mandatory_exclude_ciphers',
  'tlsproxy_tls_mandatory_protocols': r'$smtpd_tls_mandatory_protocols',
  'tlsproxy_tls_protocols': r'$smtpd_tls_protocols',
  'tlsproxy_tls_req_ccert': r'$smtpd_tls_req_ccert',
  'tlsproxy_tls_security_level': r'$smtpd_tls_security_level',
  'tlsproxy_use_tls': r'$smtpd_use_tls',
  'tlsproxy_watchdog_timeout': r'10s',
  'trace_service_name': r'trace',
  'transport_maps': r'',
  'transport_retry_time': r'60s',
  'trigger_timeout': r'10s',
  'undisclosed_recipients_header': r'',
  'unknown_address_reject_code': r'450',
  'unknown_address_tempfail_action': r'$reject_tempfail_action',
  'unknown_client_reject_code': r'450',
  'unknown_helo_hostname_tempfail_action': r'$reject_tempfail_action',
  'unknown_hostname_reject_code': r'450',
  'unknown_local_recipient_reject_code': r'550',
  'unknown_relay_recipient_reject_code': r'550',
  'unknown_virtual_alias_reject_code': r'550',
  'unknown_virtual_mailbox_reject_code': r'550',
  'unverified_recipient_defer_code': r'450',
  'unverified_recipient_reject_code': r'450',
  'unverified_recipient_reject_reason': r'',
  'unverified_recipient_tempfail_action': r'$reject_tempfail_action',
  'unverified_sender_defer_code': r'450',
  'unverified_sender_reject_code': r'450',
  'unverified_sender_reject_reason': r'',
  'unverified_sender_tempfail_action': r'$reject_tempfail_action',
  'use_srv_lookup': r'',
  'verp_delimiter_filter': r'-=+',
  'virtual_alias_address_length_limit': r'1000',
  'virtual_alias_domains': r'$virtual_alias_maps',
  'virtual_alias_expansion_limit': r'1000',
  'virtual_alias_maps': r'$virtual_maps',
  'virtual_alias_recursion_limit': r'1000',
  'virtual_delivery_slot_cost': r'$default_delivery_slot_cost',
  'virtual_delivery_slot_discount': r'$default_delivery_slot_discount',
  'virtual_delivery_slot_loan': r'$default_delivery_slot_loan',
  'virtual_delivery_status_filter': r'$default_delivery_status_filter',
  'virtual_destination_concurrency_failed_cohort_limit': r'$default_destination_concurrency_failed_cohort_limit',
  'virtual_destination_concurrency_limit': r'$default_destination_concurrency_limit',
  'virtual_destination_concurrency_negative_feedback': r'$default_destination_concurrency_negative_feedback',
  'virtual_destination_concurrency_positive_feedback': r'$default_destination_concurrency_positive_feedback',
  'virtual_destination_rate_delay': r'$default_destination_rate_delay',
  'virtual_destination_recipient_limit': r'$default_destination_recipient_limit',
  'virtual_extra_recipient_limit': r'$default_extra_recipient_limit',
  'virtual_gid_maps': r'',
  'virtual_initial_destination_concurrency': r'$initial_destination_concurrency',
  'virtual_mailbox_base': r'',
  'virtual_mailbox_domains': r'$virtual_mailbox_maps',
  'virtual_mailbox_limit': r'51200000',
  'virtual_mailbox_limit_inbox': r'no',
  'virtual_mailbox_limit_maps': r'',
  'virtual_mailbox_limit_override': r'no',
  'virtual_mailbox_lock': r'fcntl, dotlock',
  'virtual_mailbox_maps': r'',
  'virtual_maildir_extended': r'no',
  'virtual_maildir_filter': r'no',
  'virtual_maildir_filter_maps': r'',
  'virtual_maildir_limit_message': r"""Sorry, the user's maildir has overdrawn his diskspace quota, please try again later.""",
  'virtual_maildir_limit_message_maps': r'',
  'virtual_maildir_suffix': r'',
  'virtual_minimum_delivery_slots': r'$default_minimum_delivery_slots',
  'virtual_minimum_uid': r'100',
  'virtual_overquota_bounce': r'no',
  'virtual_recipient_limit': r'$default_recipient_limit',
  'virtual_recipient_refill_delay': r'$default_recipient_refill_delay',
  'virtual_recipient_refill_limit': r'$default_recipient_refill_limit',
  'virtual_transport': r'virtual',
  'virtual_transport_rate_delay': r'$default_transport_rate_delay',
  'virtual_trash_count': r'no',
  'virtual_trash_name': r'.Trash',
  'virtual_uid_maps': r'',
}


result = {"postfix":{}}
mastercf_regexp     = re.compile(r'^(?P<name>\S+)\s+(?P<type>\S+)\s+(?P<private>\S+)\s+(?P<unpriv>\S+)\s+(?P<chroot>\S+)\s+(?P<wakeup>\S+)\s+(?P<maxproc>\S+)\s+(?P<command>\S+)\s*(?P<args>\S.*)?$')
comment_regexp      = re.compile(r'^\s*#')
maincf_regexp       = re.compile(r'^(?P<key>\S+)\s*=\s*(?P<value>.*?)$')
continuation_regexp = re.compile(r'^\s+(?P<value>\S.*)$')
alias_regexp        = re.compile(r'^(?P<alias>\S+)\s*:\s+(?P<targets>\S.*)$')

def read_file(full_path):
  ret = []
  try:
    with open(full_path, "r") as f:
      fc=f.read()
      out_index = -1
      for line in fc.splitlines():
        line.strip()
        if not(comment_regexp.match(line) or '' == line):
          mo=continuation_regexp.match(line)
          if mo is None:
            ret.append(line)
            out_index += 1
          else:
            ret[out_index] = f"{ret[out_index]} {line.lstrip()}"
  except PermissionError:
    pass
  return ret

def add_config_block(filename, key, value):
  if not "config" in result["postfix"]:
    result["postfix"]["config"] = {}

  if not filename in result["postfix"]["config"]:
    result["postfix"]["config"][filename] = {}

  if key in result["postfix"]["config"][filename]:
    print(f"Warning: key already set {key}")

  result["postfix"]["config"][filename][key] = value

def handle_mastercf(full_path):
  master_fields = ["name", "type", "private", "unpriv", "chroot", "wakeup", "maxproc", "command", "args"]
  read_config = {}
  fc = read_file(full_path)
  if len(fc) > 0:
    for line in fc:
      mo=mastercf_regexp.search(line)
      if mo is not None:
        service_identifier = f"{mo.group('name')}-{mo.group('type')}"
        try:
          dsc = config_defaults['master.cf'][service_identifier]
        except KeyError:
          dsc = {}
        new_service = {}
        for field in master_fields:
          try:
            dsc_field = dsc[field]
          except KeyError:
            dsc_field = None
          if mo.group(field) != dsc_field:
            new_service[field] = mo.group(field)
        if len(new_service) > 0:
          add_config_block("master.cf", service_identifier, new_service)
      else:
        print(f"Failed to parse a line in master.cf: '{line}'")

def handle_maincf(full_path):
  read_config = {}
  fc = read_file(full_path)
  if len(fc) > 0:
    for line in fc:
      mo=maincf_regexp.match(line)
      if mo is not None:
        try:
          defaults_value = postfix_maincf_defaults[mo.group("key")]
        except KeyError:
          defaults_value = ""
        if mo.group("value") != defaults_value:
          add_config_block("main.cf", mo.group("key"), mo.group("value"))
        else:
          print(f"Skipping because it matches the default for {mo.group('key')}")
      else:
        print(f"Failed to parse a line in main.cf: '{line}'")

def handle_as_map(filename, full_path):
  fc = read_file(full_path)
  fc = [l for l in fc if '' != l]

  if len(fc) > 0:
    if not "maps" in result["postfix"]:
      result["postfix"]["maps"] = {}
    result["postfix"]["maps"][filename] = fc

def handle_aliases(full_path):
  read_config = {}
  fc = read_file(full_path)
  if len(fc) > 0:
    for line in fc:
      mo=alias_regexp.match(line)
      if mo is not None:
        add_config_block("aliases", mo.group("alias"), mo.group("targets"))
      else:
        print(f"Failed to parse a line in aliases: '{line}'")

postfix_config_dir = "/etc/postfix"
all_files = [f for f in os.listdir(postfix_config_dir) if not(f.endswith(".lmdb"))]
skip_files = [ "bounce.cf.default", "main.cf.default", "openssl_postfix.conf.in" ]
for filename in all_files:
  full_path = os.path.join(postfix_config_dir, filename)
  if os.path.isfile(full_path):
    if filename in skip_files:
      continue
    elif "master.cf" == filename:
      handle_mastercf(full_path)
    elif "main.cf" == filename:
      handle_maincf(full_path)
    elif "aliases" == filename:
      handle_aliases(full_path)
    else:
      handle_as_map(filename, full_path)

print(yaml.dump(result))